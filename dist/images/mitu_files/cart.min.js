!function(t){function e(i){if(a[i])return a[i].exports;var o=a[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){t.exports=a(1)},function(t,e,a){a(2),a(3);var i=a(6);a(7);var o=a(9);$(function(){function t(){$.ajax({url:N.urls.getList,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,error:function(){R.tipMsg("网络出错，请刷新页面！")},success:function(t){t&&1===t.code?(N.listData=t.data,e(t.data),a(),N.selGoodsTotal=0,N.goodsTotal=0,N.giftTotal=0,$("#J_cartLoading").addClass("hide")):(t.code>1e3||t.code<0)&&R.tipMsg(t.msg)}})}function e(){if($(".J_goShoping").attr("href",MI.GLOBAL_CONFIG.listSite+"/0"),N.listData.items.length<=0)return $("#J_cartEmpty").removeClass("hide"),$("#J_cartBox").addClass("hide"),$("#J_miniHeaderTitle").html("<h2>我的购物车</h2>").removeClass("has-more"),o("cUserId")||o("userId")||($("#J_cartEmpty").addClass("cart-empty-nologin"),$("#J_loginBtn").attr("data-href",MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href),$("body").on("click","#J_loginBtn",function(){var t=MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href;"1"!==o("XM_agreement_sure")?(window.needagreecookie=!0,window.agreementModalShow(t,!0)):window.location.href=t})),void D(!0);location.href.indexOf("autogo")>=0&&$("#J_goCheckout").trigger("click"),$("#J_cartBox").removeClass("hide"),$.each(N.listData.items,function(t,e){e.isOvercartTTL||e.showCos||!e.is_on_sale?(1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(N.goodsTotal+=parseInt(e.num)):(N.goodsTotal+=parseInt(e.num),e.pulse_bargains_cart&&e.pulse_bargains_cart.length&&$.each(e.pulse_bargains_cart,function(t,e){N.goodsTotal+=parseInt(e.num)}),e.pulse_gift&&e.pulse_gift.length&&$.each(e.pulse_gift,function(t,e){N.goodsTotal+=parseInt(e.num)}),e.service_info&&e.service_info.length>0&&$.each(e.service_info,function(t,e){$.each(e.service_info,function(t,e){e.item_id&&(N.goodsTotal+=parseInt(e.num))})})),e.properties&&e.properties.insurance&&e.properties.insurance.itemId&&(N.goodsTotal+=parseInt(e.num))}),N.listData.activitys.gift&&N.listData.activitys.gift.length&&$.each(N.listData.activitys.gift,function(t,e){N.giftTotal+=parseInt(e.num)});var t="";N.listData.shipmentDes?(t="<p>"+N.listData.shipmentDesc+"</p>",$("#J_miniHeaderTitle").addClass("has-more")):($("#J_miniHeaderTitle").addClass("has-more"),t="<p>温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</p>"),$("#J_miniHeaderTitle").html("<h2>我的购物车</h2>"+t),$("#J_cartTotalNum").text(N.goodsTotal+N.giftTotal).parent().removeClass("hide"),N.listData.activityDiscountMoney>0?$("#J_cartActivityMoney").text(N.listData.activityDiscountMoney).parent().removeClass("hide"):$("#J_cartActivityMoney").text("0").parent().addClass("hide"),$("#J_cartTotalPrice").text(N.listData.orderMoneySelGoods),!N.listData.postFree&&N.listData.postFreeBalance?($("#J_postFreeBalance").text(N.listData.postFreeBalance),N.listData.gatherorder_goods_list&&N.listData.gatherorder_goods_list.length>0&&($("#J_coudanTip").removeClass("hide"),$("#J_showCoudan").removeClass("hide"))):$("#J_coudanTip").addClass("hide")}function a(){if(!(N.listData.items.length<=0)){s(N.listData),N.listData.postFreeTip?$(".J_addonitemsTips").removeClass("hide").html(N.listData.postFreeTip+'<a class="J_getaddItems" href="javascript:void(0);">去凑单 &gt;</a>'):$(".J_addonitemsTips").addClass("hide");var t=parseFloat(N.listData.productMoneySelGoods),e=parseFloat(N.listData.postFreeBalance),a=$("#J_itemslist");a.find(".txt,.txt-free").addClass("hide"),0==e?a.find(".txt-free").removeClass("hide"):a.find(".txt").removeClass("hide").find(".total-price").html("&yen "+t).end().find(".need-price").html(e+"元"),n(N.listData.activitys),N.listData.giftsDiv&&N.listData.giftsDiv.length&&l(N.listData.giftsDiv),r(N.listData.bargains),N.listData.bargainDiv&&N.listData.bargainDiv.length&&c(N.listData.bargainDiv),N.listData.gatherorder_goods_list&&N.listData.gatherorder_goods_list.length&&d(N.listData.gatherorder_goods_list),N.closeGoods=[],$.each(N.listData.items,function(t,e){(e.isOvercartTTL||e.showCos||!e.is_on_sale)&&N.closeGoods.push(e)}),N.closeGoods.length&&u(),m(N.listData.items),h()}}function s(t){var e=doT.template($("#J_cartGoodsTemplate").html()),a=e(t);N.goodsList=[],t.items.map(function(t){N.goodsList.push(t.goodsId)}),$("#J_cartListBody").html(a)}function n(t){if(t){var e=doT.template($("#J_cartActivitysTemplate").html()),a=e(t);$("#J_cartListBody").append(a)}}function r(t){if(N.filterList=[],t){t.map(function(t){N.filterList.push(t.product_id)});var e=doT.template($("#J_cartRaisebuyTemplate").html()),a=e(t);$(".J_modalRaiseBuy").remove(),$("#J_raiseBuyBox").html(a)}}function c(t){if(t){$(".J_cartGoods").each(function(){var e=R.parseJson($(this).attr("data-info"));return"bargain"!==e.gettype?!0:void $.each(t,function(t,a){return e.itemid.indexOf(a.actId)<0?!0:void $.each(a.selecInfo,function(t,a){return e.itemid.indexOf(a.product_id)<0?!0:(a.num=e.num,void(a.isBuy="true"))})})});var e=doT.template($("#J_cartRaisebuyClassTemplate").html()),a=e(t);$(".J_modalRaisebuy").remove(),$("body").append(a)}}function l(t){if(t){var e=doT.template($("#J_cartGiftTemplate").html()),a=e(t);$(".J_modalGift").remove(),$("body").append(a)}}function d(t){if(t){var e=doT.template($("#J_cartCoudanTemplate").html()),a=e(t);$(".J_modalCoudan").remove(),$("body").append(a),$("#J_coudanMoney").text(N.listData.postFreeBalance)}}function u(){var t=doT.template($("#J_cartCloseTemplate").html()),e=t({items:N.closeGoods,showBusinessTip:N.listData.showBusinessTip}),a='<div class="item-disable-box">'+e+"</div>";$("#J_cartListBody").append(a)}function m(t){$.each(t,function(t,e){e.isOvercartTTL||e.showCos||!e.is_on_sale?(1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(N.selGoodsTotal+=parseInt(e.num)):((1===e.sel_status||2===e.sel_status||3===e.sel_status)&&(N.selGoodsTotal+=1*e.num,e.properties&&e.properties.insurance&&e.properties.insurance.itemId&&(N.selGoodsTotal+=parseInt(e.num)),e.pulse_bargains_cart&&e.pulse_bargains_cart.length&&$.each(e.pulse_bargains_cart,function(t,e){N.selGoodsTotal+=parseInt(e.num)}),e.pulse_gift&&e.pulse_gift.length&&$.each(e.pulse_gift,function(t,e){N.selGoodsTotal+=e.num}),e.service_info&&e.service_info.length>0&&$.each(e.service_info,function(t,e){$.each(e.service_info,function(t,e){e.item_id&&(N.selGoodsTotal+=parseInt(e.num))})})),e.pulse_bargains&&$.each(e.pulse_bargains,function(t,e){e.selectable&&p(e)}),e.pulse_gift&&$.each(e.pulse_gift,function(t,e){e.selectable&&f(e)}))}),N.selGoodsTotal===N.goodsTotal&&N.selGoodsTotal>0?$("#J_selectAll").addClass("icon-checkbox-selected"):$("#J_selectAll").removeClass("icon-checkbox-selected"),N.selGoodsTotal<=0?($("#J_goCheckout").removeClass("btn-primary").addClass("btn-disabled"),$("#J_noSelectTip").removeClass("hide")):($("#J_goCheckout").removeClass("btn-disabled").addClass("btn-primary"),$("#J_noSelectTip").addClass("hide")),$("#J_selTotalNum").html(N.selGoodsTotal+N.giftTotal)}function p(t){if(t){var e=[];e.push(t);var a=doT.template($("#J_goodsSubRaisebuyClassTemplate").html()),i=a(e);$("#J_choosePro-"+t.actId).remove(),$("body").append(i)}}function f(t){if(t){var e=[];e.push(t);var a=doT.template($("#J_cartGiftTemplate").html()),i=a(e);$("body").append(i)}}function h(){g(),C(!0),D()}function g(){$(".J_delGoods").off().on("click",function(){return J($(this)),!1}),$(".J_changeGoodsNum").on("mouseover",function(){$(this).toggleClass("change-goods-num-hover")}).on("mouseout",function(){$(this).toggleClass("change-goods-num-hover")}),$(".J_goodsNum").off().on("blur",function(){var t=parseInt($(this).val()),e=parseInt($(this).attr("data-buylimit")),a=parseInt($(this).attr("data-num")),i=$(this).attr("name"),o=$.isNumeric(t);if(o){if(1>t)return $(this).val(a),!1;if(t>e)return b(e,"input",i),R.tipMsg("该商品数量不能大于"+e),!1;b(t,"input",i)}else R.tipMsg("输入的数量只能是数字！"),$(this).val(a)}),$(".J_minus").off().on("click",function(){var t=$(this).parent().find(".J_goodsNum"),e=parseInt(t.val());return $.isNumeric(e)?e>1&&b(e,"reduce",t.attr("name")):R.tipMsg("输入的数量只能是数字！"),!1}),$(".J_plus").off().on("click",function(){var t=$(this).parent().find(".J_goodsNum"),e=parseInt(t.val()),a=parseInt(t.attr("data-buylimit")),i=t.attr("name");return $.isNumeric(e)?(e>=1&&a>e?b(e,"add",i):b(a,"add",i),!1):(R.tipMsg("输入的数量只能是数字!"),!1)}),y(),$(".J_chooseGift").on("click",function(){var t=$(this).attr("data-actId");return k("#J_choosePro-"+t),!1}),M(),S(),j(),$("#J_showCoudan").off().on("click",function(){return k("#J_CoudanBox"),!1}),$(".J_carouselList").carousel({itemPerSlide:5,containerSelector:".J_carouselContainer",controlsSelector:".J_carouselControl",controls:!1,pager:!0}),$(".J_addFavorite").on("click",function(){var t=$(this).attr("data-gid");return t?void $.ajax({url:N.urls.favorite+t,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,error:function(){},success:function(e){e&&1===e.code?$('.J_addFavorite[data-gid="'+t+'"]').addClass("is-favorite"):R.tipMsg(e.msg)}}):!1}),$(".J_itemCheckbox").on("click",function(){var t=$(this).hasClass("icon-checkbox-selected"),e=$(this).attr("data-itemid");t?_(e,0):_(e,1)});var t=$(".J_service").find(".extend-buy");t.find(".agreement").on("click",function(t){t.stopPropagation()}),t.on("click",function(){F=$(this);var t=$(this).data("pindex"),e=$(this).data("index"),a=$(this).data("sindex"),i=window.doT.template($("#J_agreementTmp").html()),o=N.listData.items[t];o=o.service_info[a].service_info[e],$("#J_modalAgreement").modal("show").html(i(o))})}function _(t,e,a){$.ajax({url:N.urls.sel,dataType:"jsonp",data:{itemId:t,status:e},jsonp:"jsonpcallback",success:function(t){1===t.code?(w(),"function"==typeof a&&a()):R.tipMsg(t.msg)}})}function v(){$("#J_selectAll").on("click",function(){var t=$(this).hasClass("icon-checkbox-selected"),e=[],a=null;$(".J_itemCheckbox").each(function(){e.push($(this).attr("data-itemid")),a=t?0:1}),e.length&&_(e.join("__"),a)})}function C(t){var e=$("#J_cartBar"),a=$(window).height(),i="cart-bar-fixed";t&&e.removeClass(i);var o=e.offset();o.top>a?e.addClass(i):e.removeClass(i);var s=0;$(window).off("scroll").on("scroll",function(){s=$(this).scrollTop()+a,s>o.top?e.removeClass(i):e.addClass(i)})}function b(t,e,a){"add"===e?t+=1:"reduce"===e&&(t-=1),$.ajax({url:MI.GLOBAL_CONFIG.cartSite+"/cart/update?api=1&Cart="+a+"__"+t,dataType:"jsonp",jsonp:"jsonpcallback",success:function(t){var e=$.trim(t.msg);if("ok"===e)MI.updateMiniCart();else{if("CANTMODIFY"===e)return R.tipMsg("非常抱歉！该商品不允许修改数量！"),!1;if("SALEOUT"===e)return R.tipMsg("修改失败！"),window.location.reload(),!1;if(e.indexOf("MAX")>-1){var a=e.split("|");return $("#J_cart_"+a[1]).val(a[2]),R.tipMsg("1"===a[3]?"每笔订单最多购买4部小米手机。如有需要，请您另下订单继续购买。":"超出商品最大购买数量。"),!1}R.tipMsg(e)}w()}})}function J(t){if(t.length){var e=t.attr("data-msg"),a=t.attr("id");R.tipMsg(e,!0,function(){$("#J_modalAlert").modal("hide"),x(a)})}}function x(t){t&&i.ajax({url:MI.GLOBAL_CONFIG.cartSite+"/cart/delete/"+t+"?api=1&ajax=cart-grid",jsonpCallback:"delgoods",callback:function(t){1===t.code?w():MI.alert({msg:t.msg,isConfirm:!1})}})}function y(){$(".J_raiseBuyItem").on("click",function(){var t=R.parseJson($(this).attr("data-info")),e=$(this).hasClass("selected");if(e)x(t.bargainid);else if("true"===t.isBatch)k("#J_choosePro-"+t.actId);else{if(t.num&&t.num>0){var a=t.maxnum-t.num+1;t.goodsId=t.productId+"-0-"+a+"-"+t.actId}T(t.goodsId,t.actId,t.type)}})}function k(t){if(t&&$(t).length){var e=$(t),a=e.find(".J_chooseProList"),i=e.find(".J_chooseProBtn"),o=e.attr("data-isadd")||!1,s=e.attr("data-isgift")||!1,n=a.find("li").length;e.addClass("modal-choose-pro-"+n),e.on("shown.bs.modal",function(){$(".modal-backdrop").addClass("modal-backdrop-dark")}).on("show.bs.modal",function(){$(this).find(".list").find("img").each(function(){$(this).attr("data-src")&&$(this).attr("src",$(this).attr("data-src"))})}).modal({backdrop:"static",show:!0}),a.children("li").on("click",function(){$(this).addClass("selected").siblings().removeClass("selected");var t=$(this).attr("data-gid"),e=$(this).attr("data-price"),a=$(this).attr("data-coudan"),o=$(this).attr("data-num"),s=$(this).attr("data-maxnum");if("true"===a){var n=N.listData.postFreeBalance-parseFloat(e);n>0?($("#J_coudanOver").addClass("hide"),$("#J_coudanDesc").removeClass("hide")):($("#J_coudanOver").removeClass("hide"),$("#J_coudanDesc").addClass("hide"))}if(o&&s){o=parseInt(o),s=parseInt(s);var r=$(this).attr("data-pid"),c=$(this).attr("data-actid");if(s>o){var l=[];$(this).siblings("li").each(function(){var t=parseInt($(this).attr("data-num"));t>0&&l.push($(this).attr("data-pid")+"-0-"+t+"-"+$(this).attr("data-actid"))}),o+=1,t=l.length?r+"-0-"+o+"-"+c+"_"+l.join("_"):r+"-0-"+o+"-"+c,$(this).attr("data-gid",t)}}i.attr("href","/cart/add/"+t).removeClass("btn-disable").addClass("btn-primary")}),i.off().on("click",function(){if($(this).hasClass("btn-disable"))return!1;var t=a.find(".selected").attr("data-gid");if("true"===o&&a.find('[data-isbuy="true"]').length>0){t="";var i=!0,n=0;a.find('[data-isbuy="true"]').each(function(){var e=$(this).attr("data-pid"),a=$(this).attr("data-num"),o=$(this).attr("data-actid");$(this).hasClass("selected")&&(a=parseInt(a)+1,i=!1),t+=(n>0?"_":"")+e+"-0-"+a+"-"+o,n+=1}),i&&(t+="_"+a.find(".selected").attr("data-gid"))}if("true"===o||"true"===s){var r=$(this).attr("data-actid"),c=$(this).attr("data-type");T(t,r,c)}else I(t);return e.modal("hide"),!1})}}function I(t){MI.addShopCart(t,function(t){t&&1===t.code?(MI.alert({msg:"加购成功",isConfirm:!1}),w()):R.tipMsg(t.msg)})}function T(t,e,a){var i=MI.GLOBAL_CONFIG.cartSite+"/cart/addCartActivity.php";$.ajax({url:i,dataType:"jsonp",data:"id="+t+"&promotion_id="+e+"&promotion_type="+a+"&api=1",jsonp:"jsonpcallback",timeout:1e4,error:function(){R.tipMsg("网络请求超时")},success:function(t){1===t.code?w():R.tipMsg(t.message)}})}function w(){t()}function M(){var t="";$(".J_showBaoxian").off().on("click",function(){var e=R.parseJson($(this).attr("data-info"));t=e.goodsId+"?parent_itemId="+e.parent_itemId,$(".J_buyBaoxian").find(".num").html(e.count+"份"),$("#J_baoxian").modal({backdrop:"static",show:!0});var a=MI.GLOBAL_CONFIG.cartSite+"/static/insuranceAgreement.php?type="+e.type;$(".J_baoxianMore").attr("href",a)}),$(".J_baoxianAgree").off().on("click",function(){$(this).toggleClass("selected")}),$(".J_buyBaoxian").off().on("click",function(){var e=$(".J_baoxianAgree").hasClass("selected");e?(I(t),$("#J_baoxian").modal("hide")):MI.alert({msg:"请先阅读并同意《小米手机意外保障服务》！",isConfirm:!1})}),$("#J_baoxian").on("hide.bs.modal",function(){$(".J_baoxianAgree").removeClass("selected")})}function S(){$(".J_showGuajia").on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");$(".J_buyGuaJia").attr("data-gid",t).attr("data-parent_itemid",e),$("#J_modalGuajia").modal({backdrop:"static",show:!0})}),$(".J_buyGuaJia").off().on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");t&&e?(t+="?parent_itemId="+e,I(t),$("#J_modalGuajia").modal("hide")):MI.alert({msg:"参数错误",isConfirm:!1})})}function j(){$(".J_showWaterInstall").on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");$(".J_buyWaterInstall").attr("data-gid",t).attr("data-parent_itemid",e),$("#J_modalWaterInstall").modal({backdrop:"static",show:!0})}),$(".J_buyWaterInstall").off().on("click",function(){var t=$(this).attr("data-gid"),e=$(this).attr("data-parent_itemid");t&&e?(t+="?parent_itemId="+e,I(t),$("#J_modalWaterInstall").modal("hide")):MI.alert({msg:"参数错误",isConfirm:!1})})}function D(t){if(t)$("#J_miRecommendBox").addClass("hide"),$("#J_historyRecommend").removeClass("hide").miRecommend({type:"historyRecommend"});else{var e=[];$(".J_cartGoods").each(function(){var t=R.parseJson($(this).attr("data-info"));t&&e.push(t.commodity_id)}),$("#J_miRecommendBox").removeClass("hide").miRecommend({type:"recommendBox",gid:e?e.join():""})}}function G(){$("#J_goCheckout").on("click",function(){var t=$("#J_goCheckout"),e=$(this).hasClass("btn-disabled");return e?!1:($(this).addClass("btn-disabled"),void $.ajax({url:N.urls.preCheckout+"?r="+R.randomNum(),dataType:"jsonp",jsonp:"jsonpcallback",timeout:5e3,error:function(){t.removeClass("btn-disabled"),location.href=MI.GLOBAL_CONFIG.orderSite+"/buy/checkout?r="+R.randomNum()},success:function(e){if(t.removeClass("btn-disabled"),1===e.code)location.href=MI.GLOBAL_CONFIG.orderSite+"/buy/checkout?r="+R.randomNum();else if(-2===e.code){var a=MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href+"?autogo";"1"!==o("XM_agreement_sure")?window.agreementModalShow(a,!0):window.location.href=a}else if(2004002===e.code)location.reload();else if(10006===e.code)R.tipMsg(e.msg);else{var i=!1;$.each(N.preCheckoutCode,function(t,a){return e.code.toString()===t?(e.texts=a,i=!0,!1):void 0}),i?B(e):R.tipMsg(e.msg)}}}))})}function B(t){if(t){$("#J_modalPrecheckTip").remove();var e=doT.template($("#J_preCheckTipTemplate").html()),a=e(t);$("body").append(a),t.data.items&&t.data.items.length>3&&$("#J_preCheckList").carousel({itemPerSlide:3,containerSelector:"#J_modalPrecheckTip",controlsSelector:".modal-bd",controls:!0,pager:!1}),$("#J_modalPrecheckTip").modal({backdrop:"static",show:!0}).on("hide.be.modal",function(){$("#J_goCheckout").removeClass("btn-disabled")}),L()}}function L(){$("#J_preCheckBtn").on("click",function(){var t=$(this).attr("data-action");if(t){if("3"===t)return $("#J_modalPrecheckTip").modal("hide"),void w();var e=$("#J_preCheckList").find("li"),a=[],i=[],o=[];$(".J_itemCheckbox").each(function(){var t=$(this).attr("data-itemid"),e=$(this).hasClass("icon-checkbox-selected"),a=$(this).attr("data-isdis");i.push(t),e&&"true"===a&&o.push(t)}),e.each(function(){var t=$(this).attr("data-itemid");a.push(t)}),"1"===t?_(i.join("__"),0,function(){_(a.join("__"),1,function(){$("#J_modalPrecheckTip").modal("hide"),$("#J_goCheckout").trigger("click")})}):"2"===t?_(a.join("__"),0,function(){$("#J_modalPrecheckTip").modal("hide"),$("#J_goCheckout").trigger("click")}):"4"===t&&o.length&&_(o.join("__"),0,function(){$("#J_modalPrecheckTip").modal("hide")})}})}function A(t){var e=new Image;if(t.data("src")&&(e.src=t.data("src"),e.src))return e.complete?void t.attr("src",e.src):void(e.onload=function(){t.attr("src",e.src)})}function O(){$("body").on("click",".J_getaddItems",function(){var t={goods_list:N.goodsList.join(",")};N.filterList.length>0&&(t.filter_list=N.filterList.join(",")),i.ajax({url:N.urls.addonitem,data:t,jsonpCallback:"addonItems",callback:function(t){if(0==t.code&&t.data&&t.data.rec_channels.length>0){var e=doT.template($("#J_addonItemsTemplate").html());$("#J_itemslist").modal("show").find(".modal-body").html(e(t.data.rec_channels)).end().find(".link").attr("href",t.data.policy_url).end().find(".active img").each(function(){A($(this))}),setTimeout(function(){window.statInit()},500)}else R.tipMsg(t.message)},error:function(){R.tipMsg("请稍后重试")}})}),$("body").on("click",".J_addItems",function(){var t=$(this).data("gid");t=String(t),I(t.split(",")[0])}),$("body").on("click","#J_itemslist .tab a",function(){if(!$(this).hasClass("active")){var t=$(this),e=$(this).index();t.addClass("active").siblings().removeClass("active"),$("#J_itemslist").find(".tab-con").find("ul").removeClass("active").eq(e).addClass("active").find("img").each(function(){A($(this))})}})}var N={urls:{addonitem:window.orderApiSite+"/rec/postfree",getList:MI.GLOBAL_CONFIG.cartSite+"/cart/getList.php?api=1",favorite:MI.GLOBAL_CONFIG.orderSite+"/favorite/add/id/",sel:MI.GLOBAL_CONFIG.cartSite+"/cart/sel.php",preCheckout:MI.GLOBAL_CONFIG.orderSite+"/buy/checkoutPreCheck.php"},listData:null,selGoodsTotal:0,goodsList:[],filterList:[],goodsTotal:0,giftTotal:0,preCheckoutCode:{2003073:{title:"以下为预售商品，需要单独结算",btn:"先购买这些商品",action:1},2003072:{title:"以下为开放购买商品，需要单独结算",btn:"先购买这些商品",action:1},2003074:{title:"以下为大型商品（需特殊配送），需要单独结算",btn:"先购买这些商品",action:1},2003075:{title:"以下为合约机，需要单独结算",btn:"先购买这些商品",action:1},2003080:{title:"以下为需要特殊配送的商品，需要单独结算",btn:"先购买这些商品",action:1},2003077:{title:"抱歉，以下商品已经失效或者暂时售罄",btn:"购买其他已选商品",action:2},2003076:{msg:"抱歉，已选商品已经失效或者暂时售罄",btn:"看看其他商品",action:4},2004046:{msg:"抱歉，已选商品已经下架",btn:"看看其他商品",action:4},2003078:{msg:"请勾选需要结算的商品",btn:"确定",action:3}}},F="";$("body").on("click",".J_agreement",function(){$(this).toggleClass("active"),$("#J_modalAgreement").find(".btn").toggleClass("btn-disabled")}),$("#J_modalAgreement").on("click",".btn",function(){if(!$(this).hasClass("btn-disabled")){var t=$(this).data("id"),e=$(this).data("pid"),a=$(this).data("source");MI.addShopCart(t,function(t){t&&1===t.code?w():R.tipMsg(t.message)},F,{parent_itemId:e,source:a}),$("#J_modalAgreement").modal("hide")}});var R={tipMsg:function(t,e,a){if(t){var i="";t.length>10&&(i="much-text"),$("#J_alertMsg").html(t).addClass(i),$("#J_modalAlert").modal("show").on("hide.bs.modal",function(){$("#J_alertMsg").html(""),$("#J_alertOk").off()}),e?$("#J_alertCancel").removeClass("hide"):$("#J_alertCancel").addClass("hide"),"function"==typeof a&&$("#J_alertOk").off().on("click",a)}else $("#J_modalAlert").modal("hide")},randomNum:function(){return parseInt(9e4*Math.random()+1e4)+"."+parseInt((new Date).getTime()/1e3)},formatImageUrl:function(t,e){if(t&&e){var a=t.lastIndexOf("."),i=t.slice(a),o=t.slice(0,a),s=o+"!"+e+"x"+e+i;return s}},formatDate:function(t,e){if(t){var a=new Date(1e3*parseInt(t)),i={Y:a.getFullYear(),M:a.getMonth()+1,D:a.getDate(),h:a.getHours()<10?"0"+a.getHours():a.getHours(),m:a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes(),s:a.getSeconds()},o=e||"##Y##-##M##-##D## ##h##:##m##:##s##",s="";for(var n in i)i[n]>=0&&(s="##"+n+"##",o.indexOf(s)>=0&&(o=o.replace(s,i[n])));return o}},parseJson:function(t){return new Function("return "+t)()}},P=function(){t(),v(),G(),$(window).on("resize",function(){C(!0)}),O()};P()})},function(t,e){!function(t){function e(e){function a(){return 0>=v?!1:(C&&clearInterval(C),void(C=setTimeout(function(){var t=b===v-1?0:b+1;i(t),a()},f.pause)))}function i(t){return b===t?!1:($.css({marginLeft:-g*h*t,transition:"margin-left "+f.speed/1e3+"s "+f.easing}),f.controls&&(0===t?d.addClass("control-disabled"):d.removeClass("control-disabled"),t===v-1?u.addClass("control-disabled"):u.removeClass("control-disabled")),f.pager&&m.find("li").eq(t).addClass("pager-active").siblings().removeClass("pager-active"),void(b=t))}function o(){for(var e='<ul class="xm-pagers">',a=0,o=v;o>a;a+=1)e+='<li class="pager'+(0===a?" pager-active":"")+'"><span class="dot">'+(a+1)+"</span></li>";e+="</ul>",m.html(e),m.find("li").off(".carousel").on("click.carousel",function(){t(this).addClass("pager-active").siblings().removeClass("pager-active"),i(m.find("li").index(t(this)))})}function s(){h=f.itemPerSlide||Math.ceil(r.width()/g),v=Math.ceil(c.length/h),1>=v||(i(0),f.pager&&o(),f.auto&&(a(),f.controls&&l.find(".control").off(".carousel").on({"mouseenter.carousel":function(){C&&clearTimeout(C)},"mouseleave.carousel":function(){a()}}),f.pager&&m.find(".pager").off(".carousel").on({"mouseenter.carousel":function(){C&&clearTimeout(C)},"mouseleave.carousel":function(){a()}})))}var n,r,c,l,d,u,m,p,f,h,g,_,v,$=t(this),C=0,b=-1;return p={itemSelector:"> li",itemWidth:null,itemHeight:null,itemPerSlide:null,containerSelector:null,controlsSelector:null,pagersSelector:null,speed:500,easing:"ease",auto:!1,pause:5e3,controls:!0,controlsClass:"xm-controls-line-small",pager:!1,onLoad:t.noop},f=t.extend({},p,e),c=$.find(f.itemSelector),f.itemPerSlide&&c.length<=f.itemPerSlide?this:(g=f.itemWidth||c.outerWidth(!0),_=f.itemHeight||c.outerHeight(),n=f.containerSelector?$.closest(f.containerSelector):$.parent(),n.addClass("xm-carousel-container"),r=$.wrap('<div class="xm-carousel-wrapper"></div>').closest(".xm-carousel-wrapper").css({height:_,overflow:"hidden"}),$.css("width",g*c.length),f.controls&&(l=t('<div class="xm-controls '+f.controlsClass+' xm-carousel-controls"><a class="control control-prev iconfont" href="javascript: void(0);">&#xe628;</a><a class="control control-next iconfont" href="javascript: void(0);">&#xe623;</a></div>'),f.controlsSelector?n.find(f.controlsSelector).append(l):l.insertAfter(r),d=l.find(".control-prev"),u=l.find(".control-next"),d.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(b-1)}),u.on("click",function(e){e.preventDefault(),t(this).hasClass("control-disabled")||i(b+1)})),f.pager&&(m=t('<div class="xm-pagers-wrapper"></div>'),f.pagersSelector?n.find(f.pagersSelector).append(m):m.insertAfter(r)),s(),f.onLoad($),void t(window).on("resize",s))}t.fn.carousel=function(t){return this.each(function(){e.call(this,t)}),this}}(jQuery)},function(t,e,a){function i(t,e,a){var i=t.find("a");$.each(i,function(t,i){var o,s=$(i).attr("data-stat-index"),n=r($(i).attr("data-stat-text")),c=$(i).attr("data-stat-method"),l=$(i).attr("data-stat-addcart");o=l?"stat_"+e+l+"."+a+"_"+s+"_"+c:"stat_"+e+"."+a+"_"+s+"_"+c,$(i).attr({"data-stat-pid":o,"data-stat-aid":n})})}function o(t){if("cart"!==n.page&&n.useCarousel){var e=t.find("ul").eq(0);e&&e.carousel({containerSelector:t,controls:n.carouselControl,pager:n.carouselPage,itemHeight:320})}n.isBuy&&($(".J_xm-recommend-list").hover(function(){$(this).find(".J_xm-recommend-btn").show()},function(){$(this).find(".J_xm-recommend-btn").hide()}),$(".J_xm-recommend-btn").off(".addcart").on("click.addcart",function(){function t(){a.removeClass("xm-recommend-notice-active"),setTimeout(function(){e.removeClass("disabled"),a.empty()},500)}var e=$(this),a=e.parent().siblings(".xm-recommend-notice");return e.hasClass("disabled")?!1:(MI.addShopCart(e.attr("data-stat-gid"),function(e){1===e.code?"cart"!==n.page?(a.addClass("xm-recommend-notice-active").empty().append('<a class="btn btn-block btn-green btn-notice" href="javascript: void(0);">成功加入购物车</a>'),a.find(".btn-notice").one("click",t),setTimeout(function(){t(),location.reload()},1e3)):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/":alert(e.msg)}),!1)})),i(t,n.page,n.pageName),$.isFunction($("body").linkSign)&&t.linkSign({live:!0});var a=t.attr("id"),o="re-"+n.page+"."+n.tips;$.force_appear(),t.appear(),t.one("appear",function(){if("undefined"!=typeof _msq&&_msq.push(["trackPanelShow",a,o]),!t.data("log_codes")){for(var e=t.find(".J_xm-recommend-list").find("dt").find("a"),i="",s=0,n=e.length;n>s;s++)i+=e.eq(s).data("log_code")+";";t.attr("data-log_codes",i.substring(0,i.length-1))}})}a(2),a(4);var s={},n={},r=function(t){try{return t.replace(/\s/g,"")}catch(e){return t}};!function(t){function e(t,e,i,s){if(t.length<5)return!1;var r=a(5),c={v:1,data:t,useCarousel:n.useCarousel,isBuy:n.isBuy,itemSite:MI.GLOBAL_CONFIG.itemSite,title:s?"买购物车中商品的人还看了":n.title,page:n.page,hideTitle:n.hideTitle,type:e.type};i.addClass("container").html(r(c)),o(i),null!==e.callback&&"function"==typeof e.callback&&e.callback()}function i(t){return t.length<5?!1:(t.length>20&&(t=t.slice(0,20)),t.length>15&&t.length<20&&(t=t.slice(0,15)),t.length>10&&t.length<15&&(t=t.slice(0,10)),t.length>5&&t.length<10&&(t=t.slice(0,5)),t)}function r(a){var o=n.api,r={cid:s.gid};t.ajax({url:o,dataType:"jsonp",jsonp:"jsonpcallback",cache:!0,data:r,success:function(o){if(0===o.code){o=o.data||{};var n=t(a);"buyRecommend"===s.type||"paySuccess"===s.type?(e(i(o.alsobuy),s,n),s.type="dirHistoryRecommend",n=t("#J_historyRecommend"),e(i(o.alsoview),s,n,!0)):e(i(o),s,n)}}})}var c={recommendBox:{api:"//rec.www.mi.com/rec/cartbuy",title:"买购物车中商品的人还买了",isBuy:!0,page:"Cart",pageName:"购物车",tips:"购物车推荐",useCarousel:!1},historyRecommend:{api:"//rec.www.mi.com/rec/cartempty",title:"为您推荐",isBuy:!0,page:"Cart",pageName:"购物车",tips:"猜你喜欢",useCarousel:!1},dirHistoryRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"根据浏览向您推荐",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"看了还看",useCarousel:!1},alsoBuy:{api:"//rec.www.mi.com/rec/detail",title:"买过该商品的人还买了",isBuy:!0,page:"ItemTail",pageName:"单品页底部",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},buyRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"买购物车中商品的人还买了",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},searchHistoryRecommend:{api:"//rec.www.mi.com/rec/search",title:"猜你喜欢",isBuy:!0,page:"Search",pageName:"搜索页",tips:"猜你喜欢",useCarousel:!0,carouselControl:!1,carouselPage:!0},homeRecommend:{api:"//rec.www.mi.com/rec/guesslike",title:"为你推荐",isBuy:!1,page:"Home",pageName:"首页",tips:"为你推荐",useCarousel:!0,carouselControl:!0,carouselPage:!1,hideTitle:!0},paySuccess:{api:"//rec.www.mi.com/rec/cartsuccess",title:"为你推荐",isBuy:!0,page:"CartSuc",pageName:"支付成功",tips:"为你推荐",useCarousel:!0,carouselControl:!1,carouselPage:!0}};t.fn.miRecommend=function(e){s=t.extend(c,e),n=s[s.type],r(this)}}(jQuery)},function(t,e){!function(t){function e(){s=!1;for(var e=0,o=i.length;o>e;e++){var n=t(i[e]).filter(function(){return t(this).is(":appeared")});if(n.trigger("appear",[n]),a){var r=a.not(n);r.trigger("disappear",[r])}a=n}}var a,i=[],o=!1,s=!1,n={interval:250,force_process:!1},r=t(window);t.expr[":"].appeared=function(e){var a=t(e);if(!a.is(":visible"))return!1;var i=r.scrollLeft(),o=r.scrollTop(),s=a.offset(),n=s.left,c=s.top;return c+a.height()>=o&&c-(a.data("appear-top-offset")||0)<=o+r.height()&&n+a.width()>=i&&n-(a.data("appear-left-offset")||0)<=i+r.width()?!0:!1},t.fn.extend({appear:function(a){var r=t.extend({},n,a||{}),c=this.selector||this;if(!o){var l=function(){s||(s=!0,setTimeout(e,r.interval))};t(window).scroll(l).resize(l),o=!0}return r.force_process&&setTimeout(e,r.interval),i.push(c),t(c)}}),t.extend({force_appear:function(){return o?(e(),!0):!1}})}(jQuery)},function(t,e){t.exports=function(t){function e(t,e){var a=/.jpg|.jpeg|.png/,i=a.exec(t),o=-1!=t.indexOf("fds.api.mi-img.com");return o?t+"?thumb=1&w="+e.w+"&h="+e.h:t.replace(a,"!"+e.w+"x"+e.h+i)}var a="";t.title&&!t.hideTitle&&(a+='<h2 class="xm-recommend-title"><span>'+t.title+"</span></h2>"),a+='<div class="xm-recommend"> ',a+=t.useCarousel?' <ul class="xm-carousel-col-5-list xm-carousel-list clearfix"> ':' <ul class="row clearfix"> ';var i=t.data;if(i)for(var o,s=-1,n=i.length-1;n>s;)o=i[s+=1],a+=" ",a+=t.useCarousel?' <li class="J_xm-recommend-list"> ':' <li class="J_xm-recommend-list span4"> ',a+=" ",a+=" ",o.ext&&o.ext.img&&o.ext.url?a+=' <a target="_blank" href="'+o.ext.url+'" data-log_code="'+o.logcode+'" data-stat-method="'+t.v+"_"+o.algorithm+'" data-stat-index='+s+' data-stat-text="'+o.name+'" data-url="'+o.ext.img+'"> <img src="'+e(o.ext.img,{w:234,h:300})+'" srcset="'+e(o.ext.img,{w:468,h:600})+'  2x" alt="'+o.name+'" class="xm-recommend-ad"/> </a> ':(a+=' <dl> <dt> <a href="'+t.itemSite+"/"+o.commodityid+'.html" data-log_code="'+o.logcode+'" data-stat-method="'+t.v+"_"+o.algorithm+'" data-stat-index='+s+' data-stat-text="'+o.name+'" target="_blank"> <img src="'+e(o.image,{w:140,h:140})+'" srcset="'+e(o.image,{w:280,h:280})+'  2x" alt="'+o.name+'" /> </a> </dt> <dd class="xm-recommend-name"> <a href="'+t.itemSite+"/"+o.commodityid+'.html" data-log_code="'+o.logcode+'" data-stat-method="'+t.v+"_"+o.algorithm+'" data-stat-index='+s+' target="_blank"> '+o.name+' </a> </dd> <dd class="xm-recommend-price">'+o.price+'元</dd> <dd class="xm-recommend-tips"> ',o.comments&&(a+=" ",parseInt(o.comments)>0&&(a+=" "+o.comments+"人好评 "),a+=" "),a+=" ",t.isBuy&&(a+=' <a href="'+t.itemSite+"/cart/add/"+o.goodsid+'-0-1" data-log_code="'+o.logcode+'" data-stat-gid="'+o.goodsid+'" data-stat-method="'+t.v+"_"+o.algorithm+'" data-stat-index='+s+' data-stat-text="'+o.name+'" data-stat-addcart="加购" class="btn btn-small btn-line-primary J_xm-recommend-btn">加入购物车</a> '),a+=' </dd> <dd class="xm-recommend-notice"></dd> </dl> '),a+=" </li>";return a+="</ul></div>"}},function(t,e){var a={ajax:function(t){var e={type:"GET",url:t.url,dataType:"jsonp",jsonp:"jsonpcallback",data:t.data||"",timeout:1e4,error:function(e,a,i){var o={};t.data&&(o=t.data),o.locationHref=window.location.href,o.errorData=e,o.errorType=a,o.error=i,_msq.push(["trackEvent","AJAX_ERROR",encodeURIComponent(t.url),JSON.stringify(o)]);

var s=t.error;s&&s(e)},success:function(e){var a=t.callback;a&&a(e)}};t.jsonpCallback&&(e.jsonpCallback=t.jsonpCallback),$.ajax(e)}};t.exports=a},function(t,e,a){MI.alert=function(t){var e,i,o={msg:"温馨提示",isConfirm:!1,onCancel:$.noop,onConfirm:$.noop},s=$.extend(o,t),n=a(8),r=$("#J_miAlert");s.msg&&(r.length||($("body").append(n),r=$("#J_miAlert")),e=r.find("#J_miAlertCancel"),i=r.find("#J_miAlertConfirm"),s.isConfirm?("function"==typeof s.onCancel&&e.on("click",s.onCancel),"function"==typeof s.onConfirm&&i.on("click",s.onConfirm)):e.remove(),r.find("#J_miAlertMsg").html(s.msg),r.modal("show"))}},function(t,e){t.exports=function(t){var e='<div class="modal fade modal-hide  modal-alert" id="J_miAlert" > <a class="close" data-dismiss="modal"  href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a> <div class="modal-bd"> <div class="text"> <h3 id="J_miAlertMsg"></h3> </div> <div class="actions"> <button class="btn btn-gray" data-dismiss="modal" id="J_miAlertCancel">取消</button> <button class="btn btn-primary"  data-dismiss="modal" id="J_miAlertConfirm">确定</button> </div> </div></div>';return e}},function(t,e){t.exports=function(t,e,a){if(arguments.length>1&&"[object Object]"!==String(e)){if(a=jQuery.extend({},a),(null===e||void 0===e)&&(a.expires=-1),"number"==typeof a.expires){var i=a.expires,o=a.expires=new Date;o.setDate(o.getDate()+i)}return e=String(e),document.cookie=[encodeURIComponent(t),"=",a.raw?e:encodeURIComponent(e),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}a=e||{};var s,n=a.raw?function(t){return t}:decodeURIComponent;return(s=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie))?n(s[1]):null}}]);